params {
    config_profile_description = 'Alliance HPC config'
    config_profile_contact = 'https://docs.alliancecan.ca/wiki/Technical_support'
    config_profile_url = 'https://docs.alliancecan.ca/wiki/Nextflow' 
}

singularity {
  enabled = true
  autoMounts = true
}

apptainer {
  autoMounts = true
}

// Group name for resource allocation must be supplied
params {
    alliance_group_name = null
}

process {
  alliance_group_name = params.alliance_group_name
  executor = 'slurm' 
  clusterOptions = "--account=${alliance_group_name}"
  maxRetries = 1
  errorStrategy = { task.exitStatus in [125,139] ? 'retry' : 'finish' }
  memory = { check_max( 4.GB * task.attempt, 'memory' ) }
  cpu = 1  
  time = '3h' 
}

executor {
  pollInterval = '60 sec'
  submitRateLimit = '60/1min'
  queueSize = 100 
}

profiles {
  beluga {
    max_memory='186G'
    max_cpu=40
    max_time='168h'
  }
  narval {
    max_memory='249G'
    max_cpu=64
    max_time='168h'
  }
  cedar {
    max_memory='186G',
    max_cpu=48,
    max_time='672h'
  }
  graham {
    max_memory='122G',
    max_cpu=32,
    max_time'168h'
  }
}