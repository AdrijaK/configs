def slurm_job_account = System.getenv("SLURM_JOB_ACCOUNT") ?: null

params {
    // Profile config
    config_profile_description = 'BlueBEAR cluster profile'
    config_profile_contact = 'Alex Lyttle (a.j.lyttle@bham.ac.uk)'
    config_profile_url = 'https://docs.bear.bham.ac.uk/'

    // Maximum resources available
    max_memory = 512.GB
    max_cpus = 112
    max_time = 10.d

    // Schema validation
    validationSchemaIgnoreParams = 'genomes,igenomes_base,project'

    // Cluster-specific params
    project = slurm_job_account
}

// Enable Singularity (via Apptainer) for all processes
// Singularity engine prefered so pipeline pulls pre-built containers rather than building them
// (see https://nf-co.re/docs/usage/installation#pipeline-software)
singularity {
    enabled = true
    autoMount = true
}

process {
    executor = 'slurm'
    clusterOptions = {
            "-A ${params.project} " +
            "-q ${task.time <= 10.m ? 'bbshort' : 'bbdefault'}"  // set QOS to bbshort if 10 min or less
    }
}

executor {
    queueSize = 60
    submitRateLimit = '1sec'
}
